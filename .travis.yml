services:
- docker
env:
  matrix:
  - COMPOSE_VERSION=3.9
  global:
  - secure: V0He4wzI0/mHF+gmRAArvwJ7RxellMwPY6gX3Cx9B3Bf5JT06lsSXnUaVDoneB6d0YcSOz34CijowoL09jwjXKe32cZ16GNcZBhY2UKDhbK38iDfU8dBcOfKdnzikUItQ4iW6LV47MT+rLsqTkOTg3tEOzEussUVpYYU8KDbRgmnf0TlxtdLG3mxYTaZkIwidVBdtoDkCUkJqNtrBloWB+mwrb++XdABNWNV7DXVJlHQOCTy88a2GVsTMDxbMsc7AW7zehKLe+6gq0m4F30TlZeG3OWyS8lm8LUoSG4ulNidSA2qiU8ZAi6Pg2YoNnMjVHUaR3JJeWHTaFb/y6XfXuEcdacYyNFKCK5B7Othy1lG6VZmn264KpUBZsvWaOq7y6U2+Yjc22XQ3iOc0ZxKeAZC5A1mq/Rlrt/rEfX+002wbqPSwLABt2WEcpqEIzFiY2L1306pL3EGx8hP8S37AHTr8MACi50TOEtLzKQj1qiWsx9RRmaNSclQ4SZyxasqyZw1LG8BhHEVyfOhGSLkQPTkPPHQ3n2aGV54knWnmjXyfRLCm5TjYg0n07zdGDwe/pPdUt0VcQtUfmfnoepiS9hK/l6wGZfS6nvd/S55C9+33tPTocmzUVqCMJvrojNMdrLnvr5xb5KNhX7kXA0U3stEiCc7UJAQCpq+ViMR3/4=
  - secure: Zb0hEEhGtFUaQT3KLa8ughwlRlzl2PQ8V5eQLBD1S4mpzy+BfeXLUzfPNAH2+Hcr8tUWyQBauLczruHLlIGIpgUrNoxY4igu7F1DP9tRnZ58O66vfOOdRvOFmkt2psilC1xs7L9OtwVzlSuqv6BlH4Oumw+NZ5Mng9Sd3e9nqMVbfQBwpGs836UXPhvVeGO26/hs0Wr3qKY6RZ9Ofj5jmZMq5mFdJCOP4/C6mHcGJsPTsIChkFyVHyfVXdtBup6Uf0ZeW/DiW4QmG7O+DxQ5X9gu2EbDnm4ksNrqpRjSN8MeBF5XQFggci1/O+W9Ls83W6ugktFPd+X22NiLqV85eC7DyDoNbaaOaQsyWlJFCAspGT/TdR/ec5dicD0hxCdkxiYZl1AHNklubwMWQxq1tHNUT6IzDIlVPHwxCwRpocj6rFvoj+kIa6x0YOrfX03pKjND6tUWOccX14bslNcV3tVPhCbZJSgJfksH/raFZIthLi6ZOse7nCuUSbeq1VqPqovW7KQZgzJn2v6SNGLOAYtkmaX5Vkt5ictOF5vFmVcODwx5Hh9qDktIJGJFJzd3j8B1iumjDNqFDbHxLrzx5zRIpDRvVjMOkGdK+Uq3MDS+f7awe+IWsbvzM/m6vAgx5oHnqYshIo1kP51Yrm4HF3gI1iYSx5u8I05vkD4+mdk=
  - secure: q4+sTMv1IN9LczBMjxO/+fPa6O9C4k/ePhZIHJcpNdwHr6KxAxv6t/qRIH3I/glCil+Gmp+SF74fOH/ua0A7J13RaA05Cki7nb5hVG8z0WvZP8PJDbjvLdZXWcVQpzywFJsVZmAG9mWRxSR6NLjVYwaNf2fOQ4tAgD3VRKNuFvykQEOmVrm5gTaZP9GjLwKCLrf07U7okhpkUuYYurghoO1LuV5HrqCHZ+Zb0HuJAeGNyo7gD9owS6MW0ZqZtd4kmUr82SHOC9HSBmzMYX/Usgbzk51Dg+LSPkJt184HtWyjuoFjNAAGHoNK1xzGg5gdrKjRKmSz6pGVUCAr56qjniZ0cmu6H6TWokHkHU5N99XjXNIGO/RKGE76tbvV+UA/BuKDG6QD0EYlWZtV3cAmNktHp0XNzVoXF2HvDtBNRz9SAOLzlkzHV7NOvZ0QgKz54JuYNAPAJCn8IDz7Cin8CI1cVsnzA6+reHK8eqlxnqJeakha5aMAsZt3fh8FSrCaSuvwWrOdaMlzMBqBFWTS2SJTDHVqRdZdCtRqKoerNb9nXHmWz8FuA4XGHXH02eC+MX9/J96iGUM9AhF/6iQX6sq2Xv7CvkS7gv4/0BGdQP627GD/zYHD9JsBoaD7xayPtk0Qrxos0/gIa6DgO5nuJPZwivuVQbhA4lZH4JcrzeI=
  - secure: Cj+Ip2LDadbcyaQyyTDMuLH3I5CBXvTXrDQQTBelG2D7YKXIa+I29yvA5x4VJ6xqpU4+rkg7uHqrHM3N7mgkXUqGFm4BARzdsghHgQbQOhzQcQN8ySFLgTXNCFWnnDEUZgG/OFHOZFW3Fi64tiNc5R4G3+CqwO2m/SxN+akl1ssgwN7ykKYz4XI8q6TLFLtYblQZP1OYvhE5KqAaaQnEukGq+CDaurx2NSmeFILVGQwoWqLD5endZpYb1Py8ZYD6o+bxrdu8qprJZcobkJkNByMgau50KafkLvJjeUIYJeSCKL3U5Qfq4xO+I00QP424IcpSC2EcQZ+3m79Ev1dtCXjLEY9WgSMPWR71QtPbAtVPC53TjadUPrTMxDQlNhqlBLAapiO6RsERQTHg12Yl13KlKX5zysFe7DJ6VdmlvpvWS4plEIabuejZR9K0/UFmdx0UCsIxCCc2PumrqzLfOVh8Y7NUEZsc4TGCYApuItNoDCHE3maruHOgByZ4ZOodu/20b0rOi8PS+QYPw820vHV1D5A6AfBr85fCQqxHHeBYjb1zne8arKqGzVXGcmW7nBNPzygTVT5MqeNozCMREKpLvLW6yOBQwiS3drDOmYKzQZhEobyd+UyTTebkF6fDHFtNQbhIuo+TsxgORBdh0CxAvPv20yLSslbm/F1Krig=
  - secure: eXDwoRk8no5DCJG0EPhJyxikUb/rIfczyd6ZL6slZYm3PnX0op2hO2sJ2dbu30HpRXFFR1dWc98Cgo7J2v0Icxsvn6xSNlIuGHYnVn2NtKjm/Hc5THirnBMj+Z4ZOtquoHLoj5a1iDaU8dkE+6ZvDobkQkHcSjzs3PiMO7I2kyEhhGpLa8b6IwBSaL5EiYRKEVBfNurRTSrEnp/o1pue9mQ+n54z+6dTWe35hmFreWw8XHntBsX1MiLo5VqiyWvNXTYHwtDVQJJ7Ri8Qnw7TSnBz0eSC8ENA56Y4ffXn9xUFDSoKIN32jTdt4O55qlj1izZFh0fHdCz2QsFiKF4EYuHNpDBz5wjafSgHmXxbSdFTWmfhjIqc0tAdk3RtDh0trRi5/NNNsKTncU8D5tlRYYfnJWLNiEXfhDUEIUDcVsGgwtQ+5FedTwdVTgzVgimU6nvaGViosuVAWoUocOsNo2q6llqA+dXMRg5jKUyvyA4VXgC7c8ho4qtYanFhFHN5YdgTP5eiPBhIkN433TRyjtEQYt5surVDfEy3cDYWGMY7J1PuJBcFCsEC9QzNJG6Dc5oDVxTysxj0uos7tCECMvu28yTK7uAgzR8ECVLb12sZhh8DKYchIEQxIonV3M3vxkwkYiDusJCt+3hW0EstQ9yfm9rvAWHv7iSv7BjTCmY=
  - DATABASE_NAME=todo_app_db
  - APP_NAME=todo-app-corndel
  # - secure: b8VmZOoV5NAO3x0TaVTWH1jKI/PHs0cR1IwskgFA+wCXOlba2EhCCjWXvgOZE84bjZEiuG0odKSvtQqTw5JWdLDIJyvnRMg/2DwGUxn0twcyBi4nd6SgAe0qoFHA+e2M/NsP2bmHmlIAf7Ge8ERbeLE/zPbKg5uCaf5Uqv26bwHIcUHXCBsx7prSWuW20hngrZ9qop2Htchp5Z3ov7ol93x9SDGCBXUflCA1zh1jCNzz/WNZVOyLqYw+fdqLXze3GQykWq7Lbo7kNn1GKubLmkZ1x+2NbsgrfJCWb7XYmqOR8crtm6Ver/xWi/1eiKSAhSLrGc8iZAteLg1/pFHY1TamGq3XjszURTKKyI+UGb1H3xLIwTIghShRchvORz4BBKXnUtaQlfnKUZ5B5SFBSZpw0quPv/17LudLu1MrPZEQHm3kRGnbK53AWdg5FsI16GGzByn+Q4d7zYkHZRqZdGXu72VCrgrIivM84MgprPoqIQVhEl70IYOE9KfaNQ7+MiTDA/91AO1+yKWCLuXLsieYn/pbL9lB8fCFE/yLGkFcCnDLKKPNyfMVLD5ksiDkOjGLgprzP/afa1Tm9kVQk4KrWQziwcVTaxcRUxSX+x9YhZlMyKNgVzdMYS+hFHjepv2sjJtLkFkTCp5jJf07ukFvJ09xiFhrxFe/BIuSGqg=
  # - secure: iyx+0Lx/oOKFd/NElCMJADLwczTQiAU3Aagldoy3TXzB0Q8hMU6gqqnU4EzBS3+wJo8iqHtp77yvGY/pJYTxrupuuHMGsmZS2cjpecplSET/VS89X1cZzok4ojw0uyypjw520LfWyD1xKdMUP97UXJgjamRwPkwGzmq2DSJSjewVi2ei+CE4gwl891UGmZDY0if/HyVQ1Ip7MlIYzdehDHKE7s/qGvjSgGyyf6esrLOjFIA0iZwE84isSjsdp7F2hvAWBP+51mmGzG8GnlOxcvQWwI3YLyWrv66NPqwsBQOjMdkrpVa/TkeLeiqJedyTqDF8LlpoZYm4oXaE0lXQRrt+OrontvKwcR1m9XRVXnqahDXoFWu4KqPCbjnd8KWIqfX6knyzlooRGm6Pvk+vHHQ18FarhvprR7nE7pPNbiOvTX5BMsXsSmJ4AQl26s2+Lmsc9wbLAocR586wQQivL39jDEQ27YEDMsdOAKFdOpMo0XMB+V9Ag/11Ar4vmWhD/Nwg4EcRG/UpXSroN/DWCZLz1kA1jzscHXZyZx9UnHCNMgASbp3ZiXQB5idgKorlPQP/TpLqoh5a00nko86nIPSv7YsHeNz5MBp6xmSyoL1fSTesEf5VCIw5QIdFwVqWNUQBiK+rrjWPXPYqzDXJgS7HR0rdTjxh/CwDj7b15g0=
notifications:
  slack:
    rooms:
    - secure: M+BuAf4koc3dYSvLyx0SO1E1A8A0gB55Gxby9IbS1oYvW9NhKS+si3Hoe6DW3m13fwkmSZK2P8J1ZEPUPFPQO8zdC63nXjROtJQSqeAv5b0Upu7xLxTeGB8K4Jq/n0sCGbtwhVMFZ0dufBCzNrAx1sh4N4fHgz5dYkk+SP/3MzJbbQsImKkDF9Hhc8zT+P8boDmyGHvoELcHS5EiWUZ20rsNiKPFkatrK+kc0OE9aB4wPpszHxK6XW0TVjrU0Lt0qrupzGNPQJETJT9jaXwKPsz9S6BPgcUF5HgvktnknygeiLZe+U9CLvmf9Pr2BlcZu7vmF+i+qMaOxn041hAkC/Wbih1UYFC/JvVfuM63MxFzTjmTbSKaXdD1D4T0ow2DQmegypbOS+UgsYJaCpV6gVHpr6OL+qP9xUvq9eTUXhJoExjYhGL+1YQnihi26UMgukflXvdPHzsEz2S2RFKiK76I42pehoq8YNUAabIei2ToT4BqsJV7lK81uF60o5EG6p2dpYQBiSOjp35XB35FAz4Xm1QoHgSMlk5IGfq/K+kHt6V0+Cil/Fz/vXk6RvohUmpI0JXCi5L4UoWZeKDIB3O3YEm68JTfL6RzMBBNCggkJNMD0gu+cp4upanridEVjYvHAagcOjgCovkdxDMBkwqTgj8tP99aVyi7hbEaqOI=
    on_success: always
    on_failure: always
before_script:
- echo "${DOCKER_HUB_PASSWORD}" | docker login --username sm4o --password-stdin
- echo "${HEROKU_API_KEY}" | docker login --username _ --password-stdin registry.heroku.com
script:
- docker build --target test --tag todo.app:test .
- docker run --env-file .env.test todo.app:test tests
- docker run --env MONGODB_CONNECTION --env DATABASE_NAME --env SECRET_KEY todo.app:test tests_e2e
# - "./scripts/run_tests.sh"
- "./scripts/run_build.sh"
deploy:
  provider: script
  script: bash ./scripts/deploy_heroku.sh
  on:
    branch: master
